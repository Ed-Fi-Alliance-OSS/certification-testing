meta {
	name: 05 - Check first GradingPeriod endDate and totalInstructionalDays was Updated
	type: http
	seq: 5
}

get {
	url: {{resourceBaseUrl}}/ed-fi/gradingPeriods/{{firstGradingPeriodUniqueId}}
	body: none
	auth: inherit
}

script:pre-request {
	const { validateDependency } = require('./utils');
	const actionHint = 'Ensure you ran the first certification scenario successfully before continuing.';

	validateDependency(bru,'firstGradingPeriodUniqueId','01 - Check first GradingPeriod is valid',{ actionHint });
	validateDependency(bru,'firstGradingPeriodEndDate','01 - Check first GradingPeriod is valid',{ actionHint });
	validateDependency(bru,'firstGradingPeriodTotalInstructionalDays','01 - Check first GradingPeriod is valid',{ actionHint });
}

assert {
	res.status: eq 200
	res.body: isDefined
	res.body.id: isString
	res.body.id: isNotEmpty
	res.body.endDate: isString
	res.body.endDate: isNotEmpty
	res.body.totalInstructionalDays: isNumber
	res.body.totalInstructionalDays: neq 0
}

script:post-response {
	const { getVar, expectChanged, throwNotFoundOrSpecificError } = require('./utils');
	const { logSpecGradingPeriod, logScenario } = require('./logging');
	const entityName='GradingPeriod';
	const scenarioName=this.req.name;

	if(res.status!==200||!res.body) throwNotFoundOrSpecificError(entityName);
	const current=res.getBody();
	expectChanged(getVar(bru,'firstGradingPeriodEndDate'),current.endDate,'endDate');
	expectChanged(getVar(bru,'firstGradingPeriodTotalInstructionalDays'),current.totalInstructionalDays,'totalInstructionalDays');
	logScenario(entityName,scenarioName,current,logSpecGradingPeriod,['endDate','totalInstructionalDays']);
}

settings {
	encodeUrl: true
}